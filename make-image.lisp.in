(in-package #:cl-user)

(load "load-stumpwm.lisp")

(stumpwm:set-module-dir "@MODULE_DIR@")

#+(or ccl clisp ecl sbcl)
(asdf:oos 'asdf:program-op "stumpwm")

;;; if you want to save an image
#+(and lispworks (not lispworks-personal-edition))
(hcl:save-image "stumpwm"
                :multiprocessing t
                :environment nil
                :load-init-files t
                :restart-function (compile nil
                                           #'(lambda ()
                                               (stumpwm:stumpwm)
                                               (lw:quit :status 0))))
;;; if you want to save a standalone executable
#+(and nil lispworks (not lispworks-personal-edition))
(lw:deliver #'stumpwm:stumpwm "stumpwm" 0
            :interface nil
            :multiprocessing t
            :keep-pretty-printer t)
#+(and lispworks lispworks-personal-edition)
(warn "StumpWM can be saved as an image only in LispWorks Pro/Enterprise editions.")
